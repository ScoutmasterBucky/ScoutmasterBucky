const y=()=>{const t=new WeakMap;return(s,n)=>(n?t.set(s,n):t).get(s)},gt=y(),bt=y(),Mt=y(),$=new Map,H=y(),rt=y(),G=y(),I=y(),$t=t=>JSON.stringify(t),V=t=>{const e=new Map;return s=>{if(e.has(s))return e.get(s);const n=t(s);return e.set(s,n),n}},J=t=>t.replace(/-(\p{Ll})/gu,e=>e[1].toUpperCase()),tt=t=>t.replace(/\p{Lu}/gu,e=>`-${e[0]}`.toLowerCase()),At=t=>tt(t.replace(/^\p{Lu}/gu,e=>e.toLowerCase())),vt=t=>`${t??""}`,Rt=t=>typeof t=="string",at=(t,e)=>t.getAttribute(e),D=(t,e,s)=>{s===!0&&(s=""),Rt(s)?t.setAttribute(e,s):t.removeAttribute(e)},M=(t,e)=>[...new Set([...t,...e])],U=t=>t.entries?.()??Object.entries(t),lt=t=>{const e=G(t);if(e)for(const[s,n]of U(e))n.length=0},W=(t,e,s)=>{const n=G(t)||G(t,{});let c=n[e];if(!c){let o=t[e];const i=Object.getOwnPropertyDescriptor(t,e)||{};c=[],n[e]=c,Object.defineProperty(t,e,{get:i.get||(()=>o),set:function(r){const l=o;if(!Object.is(r,l)){i.set?.(r),o=r;for(const p of c)p(this,r,l)}}})}c.push(s)},_t={},K=y(),Q=y(),jt=y(),wt=(t,e,...s)=>{ft(_t,t,...s),ft(K(e)||{},t,...s)},ft=(t,e,...s)=>{for(const n of t[e]??[])t[e].includes(n)&&n(...s)},A=t=>{const e=[t];let s;for(;s=e.shift();){for(const n of Q(s)??[])n();for(const n of s.childNodes)e.push(n)}},ut=(t,e,s,n)=>{const c=K(t)||K(t,{});c[s]?c[s].push(n):c[s]=[n],(Q(e)||Q(e,[])).push(()=>{const i=K(t);i?.[s]&&(i[s]=i[s].filter(r=>r!==n))})},Ht=(t,e,s)=>{const n=jt(e,{});n[s]||(n[s]=1,W(e,s,(c,o,i)=>{wt(`set:${s}`,c,t,c,o,i)}))},It=(t,e,s,n={})=>{t.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!1,composed:!0,detail:s,...n}))},be=(t,e,s,n={})=>{const c=$.get(t);c&&It(c,e,s,n)},N=document,R=window,et=t=>t.cloneNode(!0),yt=t=>N.createElement(t),Wt=t=>N.createTextNode(t),Kt=t=>N.createComment(t),qt=()=>N.createDocumentFragment(),St=()=>yt("template"),Tt=(t,e)=>N.createTreeWalker(t,e),Ft=t=>{const e=N.implementation.createHTMLDocument(""),s=e.createElement("style");return s.textContent=t,e.body.append(s),s.sheet.cssRules||[]},F=(t,e,s)=>t.classList.toggle(e,s);function P(t,e,s,n,c){ut(t,e,"set:",s);for(const o of n){const i=o in c?c:t;Ht(t,i,o),ut(i,e,`set:${o}`,s)}}const T=t=>{let e=I(t);if(t){let s=t.parentNode;for(;!e&&s;)e=I(s),s=s.parentNode}return e||(e={},I(N.body,e)),e},st=(t,e)=>{const s=Object.create(t);return I(e,s),s};let L="",k=0,a=0,C=!1;const Bt={b:"\b",f:"\f",n:`
`,r:"\r",t:"	",v:"\v"},Jt={"-":t=>e=>[-t(e)[0]],"!":t=>e=>[!t(e)[0]],"~":t=>e=>[~t(e)[0]],"+":t=>e=>[+t(e)[0]],typeof:t=>e=>[typeof t(e)[0]]},pt={"||":[3,(t,e)=>s=>[t(s)[0]||e(s)[0]]],"??":[3,(t,e)=>s=>[t(s)[0]??e(s)[0]]],"&&":[4,(t,e)=>s=>[t(s)[0]&&e(s)[0]]],"|":[5,(t,e)=>s=>[t(s)[0]|e(s)[0]]],"^":[6,(t,e)=>s=>[t(s)[0]^e(s)[0]]],"&":[7,(t,e)=>s=>[t(s)[0]&e(s)[0]]],"===":[8,(t,e)=>s=>[t(s)[0]===e(s)[0]]],"==":[8,(t,e)=>s=>[t(s)[0]==e(s)[0]]],"!==":[8,(t,e)=>s=>[t(s)[0]!==e(s)[0]]],"!=":[8,(t,e)=>s=>[t(s)[0]!=e(s)[0]]],"<<":[10,(t,e)=>s=>[t(s)[0]<<e(s)[0]]],">>>":[10,(t,e)=>s=>[t(s)[0]>>>e(s)[0]]],">>":[10,(t,e)=>s=>[t(s)[0]>>e(s)[0]]],"<=":[9,(t,e)=>s=>[t(s)[0]<=e(s)[0]]],"<":[9,(t,e)=>s=>[t(s)[0]<e(s)[0]]],">=":[9,(t,e)=>s=>[t(s)[0]>=e(s)[0]]],">":[9,(t,e)=>s=>[t(s)[0]>e(s)[0]]],instanceof:[9,(t,e)=>s=>[t(s)[0]instanceof e(s)[0]]],in:[9,(t,e)=>s=>[t(s)[0]in e(s)[0]]],"+":[11,(t,e)=>s=>[t(s)[0]+e(s)[0]]],"-":[11,(t,e)=>s=>[t(s)[0]-e(s)[0]]],"**":[13,(t,e)=>s=>[t(s)[0]**e(s)[0]],1],"*":[12,(t,e)=>s=>[t(s)[0]*e(s)[0]]],"/":[12,(t,e)=>s=>[t(s)[0]/e(s)[0]]],"%":[12,(t,e)=>s=>[t(s)[0]%e(s)[0]]]},dt={true:!0,false:!1,null:null,undefined:void 0},Y=[()=>[],[]],O=V(t=>{L=t,k=-1,f(1);let e=Y;try{C&&(e=_()||u()),C&&(e=Y,u())}catch{}return[s=>e[0](new Proxy({},{get(n,c){for(const o of s)if(c in o)return[o[c],o];return[R[c],R]}}))[0],e[1]]}),h=(t=1)=>{k+=t,a=L.charCodeAt(k),C=a>=0},E=()=>L.charAt(k),x=(t=a)=>t>47&&t<58,X=(t=a)=>t>64&&t<91||t>96&&t<123||t>127||t==36||t==95,kt=t=>X(t)||x(t),u=()=>{const t=`Parse error at index ${k}: ${L}`;throw console.error(t),new Error(t)},f=(t=0)=>{for(t&&h(t);a==32||a==9||a==10||a==13;)h()},_=()=>{const t=()=>{const o=n.pop(),i=n.pop(),r=n.pop();n.push([i[1](r[0],o[0]),M(r[1],o[1])])},e=q();if(!e)return e;let s=Z(pt);if(!s)return e;const n=[e,s,q()||u()],c=o=>o[2]^s[0]<=o[0];for(;s=Z(pt);){for(;n.length>2&&c(n[n.length-2]);)t();n.push(s,q()||u())}for(;n.length>1;)t();return n[0]},Z=t=>{for(const e of Object.keys(t))if(L.substr(k,e.length)==e&&(!X()||!kt(L.charCodeAt(k+e.length))))return f(e.length),t[e]},q=()=>{let t;if(x()||a==46)return Ct();if(a==34||a==39){const e=Nt();t=[()=>[e],[]]}else if(a===91)f(1),t=Et(93,!0);else if(a===123)t=Xt();else{const e=Z(Jt);if(e){const n=q()||u();return[e(n[0]),n[1]]}const s=nt();t=s in dt?[()=>[dt[s]],[]]:[n=>n[s],[s]]}return Ut(t)},Ut=t=>{for(;a==46||a==91||a==40||a==63;){let e,s,n=[],c=t;if(a==63){if(h(),a!==46)return h(-1),t;e=!0}if(a==91){f(1);const o=_()||u();s=(i,r)=>[i[0][o[0](r)[0]],i[0]],n=o[1],a!==93&&u(),f(1)}else if(a==40){f(1);const o=Et(41);s=(i,r)=>[i[0].apply(i[1],o[0](r)[0])],n=o[1]}else if(a==46){f(1);const o=nt();s=i=>[i[0][o],i[0]]}else u();t=e?[o=>{const i=c[0](o);return i[0]==null?[]:s(i,o)},M(c[1],n)]:[o=>s(c[0](o),o),M(c[1],n)],f()}return t},Ct=()=>{let t="";for(;x();)t+=E(),h();if(a==46)for(t+=".",h();x();)t+=E(),h();if(a==101||a==69){t+=E(),h(),(a==43||a==45)&&(t+=E(),h()),x()||u();do t+=E(),h();while(x())}(X()||a==46||t==".")&&u(),f();const e=parseFloat(t);return[()=>[e],[]]},Nt=()=>{let t="";const e=a;for(h();C&&a!=e;){if(a==92){h();const s=E();t+=Bt[s]||s}else t+=E();h()}return C||u(),f(1),t},nt=()=>{let t=k;for(X()||u(),h();C&&kt();)h();const e=L.slice(t,k);return f(),e},Et=(t,e)=>{const s=[];for(;a!==t;)C||u(),s.push(e&&a==44?Y:_()),a==44?f(1):a!==t&&u();return f(1),[n=>[s.map(c=>c[0](n)[0])],s.reduce((n,c)=>M(n,c[1]),[])]},Xt=()=>{f(1);const t=[];for(;a!==125;){let e,s;C||u(),x()||a==46?s=Ct():a==34||a==39?e=Nt():a==91?(f(1),s=_(),a!=93&&u(),f(1)):e=nt(),e&&(s=[()=>[e],[]]),a==58?(f(1),t.push([s,_()])):e?t.push([s,[n=>[n[e][0]],[e]]]):u(),a==44?f(1):a!==125&&u()}return f(1),[e=>{const s={};for(const[n,c]of t)s[n[0](e)[0]]=c[0](e)[0];return[s]},t.reduce((e,s)=>M(e,[...s[0][1],...s[1][1]]),[])]},xt=t=>{const e=t.split(/{{(.*?)}}/s);if(e.length<2)return null;const s=[];let n=!1,c=[];for(const o of e){if(n){const i=O(o);s.push(i[0]),c=M(c,i[1])}else s.push(o);n=!n}return[s,c]},Lt=t=>t?[e=>t[0].map(s=>vt(s?.call?s(e):s)).join(""),t[1]]:null,zt=V(t=>{const e=xt(t),s=e?.[0];return s?.length===3&&s[0]===""&&s[2]===""?[n=>{const c=s[1](n);return typeof c=="boolean"?c:vt(c)},e[1]]:Lt(e)}),Gt=V(t=>Lt(xt(t))),Qt=(t,e,s,n)=>{const c=zt(s);if(c){const o=T(e),i=r=>{D(e,n,c[0]([o,r]))};P(t,e,i,c[1],o),i(t)}},Yt={window:()=>{},document:()=>{},stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:(t,e)=>t.target!==e,outside:(t,e)=>e.contains(t.target),ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>t.button!==0,middle:t=>t.button!==1,right:t=>t.button!==2,exact:(t,e,s)=>["ctrl","shift","alt","meta"].some(n=>t[`${n}Key`]&&!s.has(n))},Zt=(t,e,s,n)=>{const[c,...o]=J(n.slice(1)).split("."),i=Object.create(T(e)),r=O(s),l=g=>{i.$event=g,r[0]([i,t])},p={},m=new Set(o);let b=e;for(const g of["passive","capture","once"])m.has(g)&&(p[g]=!0);m.has("window")&&(b=R),(m.has("document")||m.has("outside"))&&(b=N),b.addEventListener(c,g=>{o.some(v=>(Yt[v]||(d=>At(d.key)!==(v.match(/^code-\d+$/)?String.fromCodePoint(+v.split("-")[1]):v)))(g,e,m))||l(g)},p),D(e,n)},Vt=(t,e,s,n)=>{const c=O(s),o=T(e),i=r=>{for(const[l,p]of U(c[0]([o,r])))F(e,l,!!p)};P(t,e,i,c[1],o),i(t),D(e,n)},te=(t,e,s,n)=>{t[J(s)]=e,D(e,n)},ee=(t,e,s,n)=>{const c=O(s),o=J(n.slice(1)),i=T(e),r=l=>{const p=c[0]([i,l]);e[o]=p};P(t,e,r,c[1],i),r(t),D(e,n)},se=(t,e,s,n)=>{let c="key",o="value";const i=n.match(/^\s*(?:(?:(\S+)\s*,\s*)?(\S+)\s+of\s+)?(\S+)\s*$/);i&&(c=i[1]||c,o=i[2]||o,n=i[3]);const r=O(n),l=T(e);let p=new Map;const m=b=>{const g=r[0]([l,b])||[];let v=p;p=new Map;let d=e;for(const[S,it]of U(g)){let w=v.get(S);if(v.delete(S),w===d.nextSibling){const j=T(w);j[o]=it}else{w&&(A(w),w.remove()),w=et(s);const j=st(l,w);j[c]=S,j[o]=it,ct(w,b),d.after(w)}d=w,p.set(S,d)}for(const S of v.values())A(S),S.remove()};P(t,e,m,r[1],l),m(t)},ne=(t,e,s,n)=>{const c=O(n),o=T(e);let i=null;const r=l=>{c[0]([o,l])?i||(i=et(s),st(o,i),ct(i,l),e.after(i)):i&&(A(i),i.remove(),i=null)};P(t,e,r,c[1],o),r(t)},oe=(t,e,s,n)=>{let c="index";const o=n.match(/^(\S+)\s+as\s+(\S+)$/);o&&(n=o[1],c=o[2]);const i=O(n),r=T(e);let l=[];const p=m=>{let b=+i[0]([r,m]);for(;l.length>b;){const d=l.pop();A(d),d.remove()}let g=l.length+1,v=l[g-1]||e;for(;l.length<b;){let d=et(s);const S=st(r,d);S[c]=g++,ct(d,m),l.push(d),v.after(d),v=d}};P(t,e,p,i[1],r),p(t)},ce=0,ie=1,Dt=[{"*for":se,"*if":ne,"*repeat":oe},{"":Qt,"@":Zt,"#class":Vt,"#ref":te,".":ee}];function re(t,e){if(e.nodeType===1)for(const s of[...e.attributes]){const n=s.nodeName,c=n.charAt(0),o=Dt[ie];(o[n]||o[c]||o[""])?.(t,e,s.nodeValue||"",n)}}const ae=(t,e,s)=>{const n=s.attributes;if(s.nodeType===1&&n){let c;for(const[o,i]of U(Dt[ce])){const r=n.getNamedItem(o);if(r){if(c)throw new Error(`${c[0]} breaks ${o}`);c=[o,i,r.nodeValue||""]}}if(c){const o=Kt(`${c[0]}=${$t(c[2])}`);return s.before(o),e.previousNode(),s.remove(),D(s,c[0]),c[1](t,o,s,c[2],c[0]),1}}};function le(t,e){if(e.nodeType===3){const s=Gt(e.textContent||"");if(s){const n=T(e),c=o=>{e.nodeValue=s[0]([n,o])};return P(t,e,c,s[1],n),c(t),1}}}const ot=(t,e)=>{const s=Tt(t,133);let n;for(;n=s.nextNode();)n.nodeName==="TEMPLATE"&&ot(n.content,e),ae(e,s,n)||le(e,n)||re(e,n)},ct=(t,e)=>{const s=qt();s.append(t),ot(s,e)},ht="DOMContentLoaded",fe=(t,e,s)=>{const n=t.ownerDocument,c=()=>{let o=t;do if(o.nextSibling)return!0;while(o=o.parentNode);return!1};if(e===t||n.readyState!=="loading"||c())s();else{const o=pe(n,t,i=>{(i||c())&&(o(),s())})}},ue=t=>{let e=t;do t=e,e=t.parentNode;while(e&&e.nodeType===1);return t},pe=(t,e,s)=>{const n=()=>{s(!0)};t.addEventListener(ht,n);const c=ue(e),o=rt(c)||rt(c,{s:new Set}),i=()=>{s(!1)};return o.s.add(i),o.o||(o.o=new MutationObserver(()=>{for(const r of[...o.s])r()}),o.o.observe(c,{childList:!0,subtree:!0})),()=>{o.s.delete(i),t.removeEventListener(ht,n),o.s.size||(o.o.disconnect(),delete o.o)}};class de extends HTMLElement{constructor(){super()}attributeChangedCallback(e,s,n){const c=J(e),o=H(this);o&&s!==n&&this._changeControllerProperty(o,c,n)}connectedCallback(){const e=this.constructor,s=new(bt(e)),n=gt(e),o=n.useShadow?this.shadowRoot||this.attachShadow({mode:"open"}):this,i=o.getRootNode();H(this,s),$.set(s,this),Mt(s,n),F(this,n.className,!0),this._bindings(n,s),s.onInit?.(),fe(this,o,()=>{s.onParse?.();const r=St();if(r.innerHTML=n.template,ot(r.content,s),o.innerHTML="",n.style&&!i.querySelector("style."+n.className)){const l=yt("style");F(l,n.className,!0),l.prepend(Wt(n.style)),(i.body||i).prepend(l)}o.append(r.content),s.onViewInit?.()})}disconnectedCallback(){const e=H(this);e?.onDestroy?.(),A(this),$.delete(e),lt(this),lt(e)}_bindings(e,s){for(const n of e.attr??[]){const c=tt(n);this.hasAttribute(c)&&this._changeControllerProperty(s,n,at(this,c)),(e.prop||[]).includes(n)||W(s,n,(o,i)=>{const r=$.get(o);r&&at(r,c)!==`${i}`&&D(r,c,i)})}for(const n of e.prop??[]){const c=(i,r)=>{const l=H(i);this._changeControllerProperty(l,n,r)};n in this&&c(this,this[n]),W(this,n,c);const o=(i,r)=>{const l=$.get(i);l&&(l[n]=r)};W(s,n,o),o(s,s[n])}}_changeControllerProperty(e,s,n){const c=e[s];e[s]=n,e.onChange?.(s,c,n)}}let B=new Map,Pt=()=>{(t=>B=R[t]??(R[t]=B))("__fudgel"),Pt=()=>{}};const he=()=>{const t=B.get("n")||0;return B.set("n",t+1),t},mt=customElements,ve=(t,e,s)=>{Pt();const n=`fudgel-${he()}`,c=me(e.style||"",t,n,e.useShadow),o={...e,className:n,style:c};class i extends de{}i.observedAttributes=(o.attr||[]).map(tt),gt(i,o),bt(i,s||class{});const r=St();return r.innerHTML=o.template,Ot(r,n),o.template=r.innerHTML,wt("component",i,i,o),mt.get(t)||mt.define(t,i),i},Ot=(t,e)=>{const s=Tt(t.content,1);let n;for(;n=s.nextNode();)n.nodeName==="TEMPLATE"&&Ot(n,e),F(n,e,!0)},me=(t,e,s,n)=>{const c=(i,r)=>{i[z]&&(i[z]=i[z].split(",").map(l=>o(l,r)).join(","),r="");for(const l of i.cssRules??[])c(l,r);return i.cssText},o=(i,r)=>{i=i.trim();const l=b=>`${b}.${s}`,p=(b,g)=>b.replace(/:host/,g),m=p(i,"")===i;return n?(m||i.includes(" "))&&(i=l(i)):(i=p(i,r),m&&(i=`${r} ${l(i)}`)),i};return[...Ft(t)].map(i=>c(i,e)).join("")},z="selectorText",ge=(t,...e)=>String.raw({raw:t},...e),we=ge;export{we as a,ve as c,be as e,ge as h};
